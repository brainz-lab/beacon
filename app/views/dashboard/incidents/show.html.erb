<% content_for(:title) { @incident.title } %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <span class="flex-shrink-0 inline-flex items-center justify-center h-10 w-10 rounded-full" style="background: <%= @incident.severity == 'critical' ? '#EF4444' : (@incident.severity == 'major' ? '#F59E0B' : '#6B6760') %>;">
        <span class="text-[12px] font-medium text-white"><%= @incident.severity[0..1].upcase %></span>
      </span>
      <div>
        <h1 class="text-[22px] font-semibold tracking-tight" style="color: #1A1A1A;"><%= @incident.title %></h1>
        <p class="mt-1 text-[13px]" style="color: #8B8780;">
          <%= @monitor.name %> &middot; Started <%= @incident.started_at.strftime("%b %d, %Y at %H:%M %Z") %>
        </p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <% unless @incident.resolved? %>
        <%= button_to "Resolve", resolve_dashboard_project_incident_path(@project, @incident), method: :post, class: "px-4 py-2 text-[13px] font-medium rounded-lg transition-colors", style: "background: #10B981; color: #FFFFFE;" %>
      <% end %>
      <%= link_to "Edit", edit_dashboard_project_incident_path(@project, @incident), class: "px-4 py-2 text-[13px] font-medium rounded-lg transition-colors", style: "background: #FFFFFE; border: 1px solid #E8E5E0; color: #1A1A1A;" %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Status -->
      <div class="px-5 py-5 rounded-xl" style="background: #FFFFFE; border: 1px solid #E8E5E0;">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-[13px] font-medium" style="color: #8B8780;">Status</p>
            <p class="mt-1 text-[28px] font-semibold" style="color: <%= @incident.resolved? ? '#10B981' : '#EF4444' %>;">
              <%= @incident.status.humanize %>
            </p>
          </div>
          <div class="text-right">
            <p class="text-[13px] font-medium" style="color: #8B8780;">Duration</p>
            <p class="mt-1 text-[24px] font-semibold" style="color: #1A1A1A;"><%= @incident.duration_humanized %></p>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="rounded-xl" style="background: #FFFFFE; border: 1px solid #E8E5E0;" id="incident_updates">
        <div class="px-5 py-4" style="border-bottom: 1px solid #E8E5E0;">
          <h2 class="text-[15px] font-medium" style="color: #1A1A1A;">Timeline</h2>
        </div>
        <div class="px-5 py-5">
          <div class="flow-root">
            <ul class="-mb-8">
              <% @updates.each_with_index do |update, index| %>
                <li>
                  <div class="relative pb-8">
                    <% unless index == @updates.size - 1 %>
                      <span class="absolute left-4 top-4 -ml-px h-full w-0.5" style="background: #E8E5E0;"></span>
                    <% end %>
                    <div class="relative flex gap-3">
                      <div>
                        <span class="h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white" style="background: <%= update.status == 'resolved' ? '#10B981' : (update.status == 'identified' ? '#F59E0B' : '#6B6760') %>;">
                          <svg class="h-4 w-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                          </svg>
                        </span>
                      </div>
                      <div class="flex min-w-0 flex-1 justify-between gap-4 pt-1.5">
                        <div>
                          <p class="text-[14px] font-medium" style="color: #1A1A1A;"><%= update.status.humanize %></p>
                          <p class="mt-1 text-[13px]" style="color: #6B6760;"><%= update.message %></p>
                        </div>
                        <div class="whitespace-nowrap text-right">
                          <p class="text-[13px]" style="color: #8B8780;"><%= update.created_at.strftime("%H:%M") %></p>
                          <p class="text-[11px]" style="color: #8B8780;"><%= update.created_by %></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>

      <!-- Add Update -->
      <% unless @incident.resolved? %>
        <div class="rounded-xl" style="background: #FFFFFE; border: 1px solid #E8E5E0;" id="update_form">
          <%= render "dashboard/incidents/update_form", incident: @incident %>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Details -->
      <div class="rounded-xl" style="background: #FFFFFE; border: 1px solid #E8E5E0;">
        <div class="px-5 py-4" style="border-bottom: 1px solid #E8E5E0;">
          <h2 class="text-[15px] font-medium" style="color: #1A1A1A;">Details</h2>
        </div>
        <div class="divide-y" style="border-color: #E8E5E0;">
          <div class="px-5 py-3 flex justify-between">
            <span class="text-[13px]" style="color: #8B8780;">Severity</span>
            <span class="px-2 py-0.5 text-[11px] font-medium rounded-full" style="background: <%= @incident.severity == 'critical' ? '#FEE8E8' : (@incident.severity == 'major' ? '#FEF3C7' : '#F5F4F2') %>; color: <%= @incident.severity == 'critical' ? '#8B2D2D' : (@incident.severity == 'major' ? '#92400E' : '#6B6760') %>;">
              <%= @incident.severity %>
            </span>
          </div>
          <div class="px-5 py-3 flex justify-between">
            <span class="text-[13px]" style="color: #8B8780;">Started</span>
            <span class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.started_at.strftime("%b %d, %H:%M") %></span>
          </div>
          <% if @incident.resolved? %>
            <div class="px-5 py-3 flex justify-between">
              <span class="text-[13px]" style="color: #8B8780;">Resolved</span>
              <span class="text-[13px] font-medium" style="color: #1A1A1A;"><%= @incident.resolved_at.strftime("%b %d, %H:%M") %></span>
            </div>
          <% end %>
          <% if @incident.root_cause.present? %>
            <div class="px-5 py-3">
              <p class="text-[13px]" style="color: #8B8780;">Root Cause</p>
              <p class="mt-1 text-[13px]" style="color: #1A1A1A;"><%= @incident.root_cause %></p>
            </div>
          <% end %>
          <% if @incident.resolution_notes.present? %>
            <div class="px-5 py-3">
              <p class="text-[13px]" style="color: #8B8780;">Resolution</p>
              <p class="mt-1 text-[13px]" style="color: #1A1A1A;"><%= @incident.resolution_notes %></p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Affected Monitor -->
      <div class="rounded-xl" style="background: #FFFFFE; border: 1px solid #E8E5E0;">
        <div class="px-5 py-4" style="border-bottom: 1px solid #E8E5E0;">
          <h2 class="text-[15px] font-medium" style="color: #1A1A1A;">Affected Monitor</h2>
        </div>
        <div class="px-5 py-4">
          <div class="flex items-center gap-3">
            <span class="h-2 w-2 rounded-full" style="background: <%= @monitor.status == 'up' ? '#10B981' : (@monitor.status == 'degraded' ? '#F59E0B' : '#EF4444') %>;"></span>
            <%= link_to @monitor.name, dashboard_project_monitor_path(@project, @monitor), class: "text-[14px] font-medium hover:opacity-70 transition-opacity", style: "color: #1A1A1A;" %>
          </div>
          <p class="mt-1 text-[13px]" style="color: #8B8780;"><%= @monitor.url || @monitor.host %></p>
        </div>
      </div>
    </div>
  </div>
</div>
